<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/admin/css/couponManagement.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <title>coupon-management</title>
</head>

<body>

    <div class="whole">
        <div class="menu">
            <div class="logo"><img class="log" src="/admin/images/logo_black.png" alt=""></div>
            <div class="menu_items">
                <div class="items"><img src="/admin/images/admin online.png" alt=""><span class="tag ">Profile</span>
                </div>
                <div class="items"><img src="/admin/images/dashboard.png" alt=""><span class="tag ">Dashboard</span>
                </div>
                <a href="/admin/product">
                    <div class="items"><img src="/admin/images/product.png" alt=""><span class="tag ">Products</span>
                    </div>
                </a>
                <a href="/admin/category">
                    <div class="items"><img src="/admin/images/category.png" alt=""><span class="tag ">Category</span>
                    </div>
                </a>
                <div class="items"><img src="/admin/images/orders.png" alt=""><span class="tag ">Orders</span>
                </div>
                <div class="items"><img src="/admin/images/coupons.png" alt=""><span class="tag ">Coupons</span>
                </div>
                <div class="items"><img src="/admin/images/banner.png" alt=""><span class="tag ">Banner</span>
                </div>
                <div class="items"><img src="/admin/images/transactions.png" alt=""><span
                        class="tag ">Transactions</span></div>
                <div class="items"><img src="/admin/images/manageadmin.png" alt=""><span class="tag ">Admin</span></div>
                <a href="/admin">
                    <div class="items"><img src="/admin/images/users.png" alt=""><span class="tag ">User</span>
                    </div>
                </a>
                <div class="items"><img src="/admin/images/settings.png" alt=""><span class="tag ">Settings</span></div>
                <a href="/logout">
                    <div class="items"><img src="/admin/images/logout.png" alt=""><span class="tag ">Logout</span></div>
                </a>
            </div>
        </div>
        <div class="main">

            <div class="content  ">

                <!-- Button trigger modal -->
                <button type="button" class="btn bg-success  addcategory" data-toggle="modal" data-target="#addcoupons">
                    <img src="/admin/images/plus.png" style=" margin-right: 10px;" alt=""><span class="add">Add
                        coupons</span>
                </button>

                <div class="modal fade" id="addcoupons" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle">Coupons</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <form action="/admin/addCoupon" method="POST">
                                <div class="modal-body">

                                    <div class="form-group">
                                        <label for="Code">Code:</label>
                                        <input type="text" class="form-control" id="Code" name="Code">
                                        <div class="error" id="CodeError"> </div>
                                    </div>


                                    <div class="form-group">
                                        <label for="Min_purchase_amount">Min Purchase Amount:</label>
                                        <input type="number" class="form-control" id="Min_purchase_amount"
                                            name="Min_purchase_amount">
                                        <div class="error" id="minError"> </div>
                                    </div>


                                    <div class="form-group">
                                        <label for="Max_discount_value">Max Purchase Value:</label>
                                        <input type="number" class="form-control" id="Max_purchase_amount"
                                            name="Max_purchase_amount">
                                        <div class="error" id="maxError"> </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="Start_date">Start Date:</label>
                                        <input type="date" class="form-control" id="Start_date" name="Start_date">
                                        <div class="error" id="strDateError"> </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="Expiration_date">Expiration Date:</label>
                                        <input type="date" class="form-control" id="Expiration_date"
                                            name="Expiration_date">
                                        <div class="error" id="expDateError"> </div>
                                    </div>





                                    <div class="form-group">
                                        <label for="Max_usage_count">Max Usage Count:</label>
                                        <input type="number" class="form-control" id="Max_usage_count"
                                            name="Max_usage_count">
                                        <div class="error" id="maxCountError"> </div>
                                    </div>


                                    <div class="form-group">
                                        <label for="Discount_value">Discount Value:</label>
                                        <input type="number" class="form-control" id="Discount_value"
                                            name="Discount_value">
                                        <div class="error" id="discountError"> </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="submit" name="submit" class="btn btn-success">Add
                                        Coupon</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>


                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th scope="col">No</th>
                            <th scope="col">Coupon Code</th>
                            <th scope="col">Discount</th>
                            <th scope="col">Min</th>
                            <th scope="col">Max</th>
                            <th scope="col">Start</th>
                            <th scope="col">Expiry</th>
                            <th scope="col">Status</th>
                            <th scope="col">Created</th>

                            <th scope="col">
                                Actions</th>
                            <th scope="col"></th>

                        </tr>
                    </thead>
                    <% coupons.forEach((value,index)=> { %>


                        <tbody>


                            <tr>
                                <th scope="row">
                                    <%=index+1%>
                                </th>

                                <td>
                                    <%=value.Code%>
                                </td>
                                <td>
                                    <%=value. Discount_value%>%
                                </td>
                                <td>
                                    ₹ <%=value. Min_purchase_amount%>
                                </td>
                                <td> ₹<%=value.Max_discount_value%>
                                </td>
                                <td>

                                    <%- new Date(value.Start_date).toLocaleDateString('en-GB', { day: '2-digit' ,
                                        month: '2-digit' , year: 'numeric' }) %>
                                </td>
                                <td>

                                    <%- new Date(value.Expiration_date).toLocaleDateString('en-GB', { day: '2-digit' ,
                                        month: '2-digit' , year: 'numeric' }) %>
                                </td>
                                <%if(value.Is_active==true){%>
                                    <td
                                        style="width: 100px; height: 35px; display: flex; justify-content: center;align-items: center; background-color: green !important;margin-top: 7px; color: white;">
                                        active</td>

                                    <%}else{%>
                                        <td
                                            style="width: 100px; height: 35px; display: flex; justify-content: center;align-items: center; background-color: red !important;margin-top: 7px; color: white;">
                                            expired</td>

                                        <%}%>
                                            <td>

                                                <%- new Date(value.created).toLocaleDateString('en-GB', { day: '2-digit'
                                                    , month: '2-digit' , year: 'numeric' }) %>
                                            </td>

                                            <td>
                                                <button class="btn btn-sm" data-toggle="modal" data-target="">
                                                    <img src="/admin/images/edit.png" alt="" width="12" height="12">
                                                </button>
                                            </td>
                                            <td>











            </div>
            <button class="btn btn-sm" data-toggle="modal" data-target="">
                <img src="/admin/images/delete.png" alt="" width="12" height="12">
            </button>
            </td>





            </tr>

            </tbody>
            <% }) %>
                </table>
        </div>

    </div>







    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">


    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <script>
        document.querySelector("form").addEventListener("submit", function (event) {
            function isEmpty(value) {
                const trimmedValue = value.trim();
                return trimmedValue === "";
            }
            function isDateBeforeToday(date) {
                const currentDate = new Date();
                const inputDate = new Date(date);
                currentDate.setHours(0, 0, 0, 0);
                inputDate.setHours(0, 0, 0, 0);

                return inputDate < currentDate;
            }
            function maxcheck(min, max) {
                return max < min;
            }

            function isDateBefore(date1, date2) {
                const firstDate = new Date(date1);
                const secondDate = new Date(date2);
                firstDate.setHours(0, 0, 0, 0);
                secondDate.setHours(0, 0, 0, 0);

                return firstDate > secondDate;
            }
            function isValueLessThanZero(value) {
                return value < 0;
            }
            function isValuegreaterThanhundred(value) {
                return value < 0;
            }

            const code = document.getElementById('Code');
            const codeValue = code.value;
            const codeError = document.getElementById('CodeError');


            const Min_purchase_amount = document.getElementById('Min_purchase_amount');
            const Min_purchase_amountValue = Min_purchase_amount.value;
            const minError = document.getElementById('minError');

            const Max_purchase_amount = document.getElementById('Max_purchase_amount');
            const Max_purchase_amountValue = Max_purchase_amount.value;
            const maxError = document.getElementById('maxError');

            const Expiration_date = document.getElementById('Expiration_date');
            const Expiration_dateValue = Expiration_date.value;
            const expDateError = document.getElementById('expDateError');

            const Start_date = document.getElementById('Start_date');
            const Start_dateValue = Start_date.value;
            const strDateError = document.getElementById('strDateError');

            const Max_usage_count = document.getElementById('Max_usage_count');
            const Max_usage_countValue = Max_usage_count.value;
            const maxCountError = document.getElementById('maxCountError');

            const Discount_value = document.getElementById('Discount_value');
            const Discount_valueValue = Discount_value.value;
            const discountError = document.getElementById('discountError');


            codeError.textContent = "";
            minError.textContent = "";
            maxError.textContent = "";
            expDateError.textContent = "";
            Start_date.textContent = "";
            maxCountError.textContent = "";
            discountError.textContent = "";

            if (isEmpty(codeValue)) {
                codeError.textContent = " code field can't be empty";
                event.preventDefault();
            }
            if (isEmpty(Min_purchase_amountValue)) {
                minError.textContent = "min purchase amount field can't be empty";
                event.preventDefault();
            }
            if (isValueLessThanZero(Min_purchase_amountValue)) {
                minError.textContent = "min purchase amount field can't be less than 0";
                event.preventDefault();
            }
            if (isEmpty(Max_purchase_amountValue)) {
                maxError.textContent = "max purchase amount field can't be empty";
                event.preventDefault();
            }
            if (maxcheck(Min_purchase_amountValue, Max_purchase_amountValue)) {
                maxError.textContent = "max purchase amount  can't be less than min amount";
                event.preventDefault();
            }

            if (isValueLessThanZero(Max_purchase_amountValue)) {
                maxError.textContent = "max purchase amount field can't be less than 0";
                event.preventDefault();
            }
            if (isEmpty(Start_dateValue)) {
                strDateError.textContent = " starting date field can't be empty";
                event.preventDefault();
            }
            if (isDateBeforeToday(Start_dateValue)) {
                strDateError.textContent = "not a valida date";
                event.preventDefault();
            }

            if (isEmpty(Expiration_dateValue)) {
                expDateError.textContent = " Expiration date field can't be empty";
                event.preventDefault();
            }
            if (isDateBeforeToday(Expiration_dateValue)) {
                expDateError.textContent = "not a valida date";
                event.preventDefault();
            }

            if (isDateBefore(Start_dateValue, Expiration_dateValue)) {
                expDateError.textContent = "expire date can't be before start date";
                event.preventDefault();
            }
            if (isEmpty(Max_usage_countValue)) {
                maxCountError.textContent = "max usage field can't be empty";
                event.preventDefault();
            }

            if (isValueLessThanZero(Max_usage_countValue)) {
                maxCountError.textContent = "usage count field can't be less than 0";
                event.preventDefault();
            }
            if (isEmpty(Discount_valueValue)) {
                discountError.textContent = "discount value field can't be empty";
                event.preventDefault();
            }
            if (isValueLessThanZero(Discount_valueValue)) {
                discountError.textContent = "discount value can't be less than 0";
                event.preventDefault();
            }
        })
    </script>
</body>

</html>